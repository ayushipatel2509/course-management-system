{% extends "base.html" %}
{% block content %}
<h2 class="text-center mb-4">Register</h2>

<form method="POST" class="mx-auto" style="max-width: 400px;" onsubmit="return validatePasswordMatch()">
    <div class="mb-3">
        <label for="role" class="form-label">Register as</label>
        <select class="form-select" name="role" id="roleSelect" required onchange="toggleRoleFields(this.value)">
            <option value="student">Student</option>
            <option value="admin">Admin</option>
        </select>
    </div>

    <div class="mb-3" id="studentIdField">
        <label for="student_id" class="form-label">Student ID</label>
        <input type="text" class="form-control" name="student_id">
    </div>

    <div class="mb-3" id="departmentField" style="display: none;">
        <label for="department" class="form-label">Department</label>
        <input type="text" class="form-control" name="department">
    </div>

    <div class="mb-3">
        <label class="form-label">Full Name</label>
        <input type="text" class="form-control" name="full_name" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Email</label>
        <input type="email" class="form-control" name="email" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Phone</label>
        <input type="text" class="form-control" name="phone">
    </div>

    <div class="mb-3">
        <label class="form-label">Password</label>
        <input type="password" class="form-control" name="password" id="passwordInput" required>
        <small class="text-muted">Must contain a letter, number, special character and be at least 6 characters.</small>
    </div>

    <div class="mb-3">
        <label class="form-label">Re-enter Password</label>
        <input type="password" class="form-control" name="confirm_password" id="confirmPasswordInput" required>
    </div>

    <button type="submit" class="btn btn-primary w-100">Register</button>

    <div class="mt-3 text-center">
        Already have an account? <a href="{{ url_for('routes.login') }}">Login here</a>
    </div>
</form>

<script>
    function toggleRoleFields(role) {
        document.getElementById('studentIdField').style.display = role === 'student' ? 'block' : 'none';
        document.getElementById('departmentField').style.display = role === 'admin' ? 'block' : 'none';
    }

    function validatePasswordMatch() {
        const password = document.getElementById("passwordInput").value;
        const confirm = document.getElementById("confirmPasswordInput").value;
        if (password !== confirm) {
            alert("âŒ Passwords do not match.");
            return false;
        }
        return true;
    }

    // Run on load to handle pre-filled role
    document.addEventListener('DOMContentLoaded', () => {
        toggleRoleFields(document.getElementById('roleSelect').value);
    });
</script>
{% endblock %}
